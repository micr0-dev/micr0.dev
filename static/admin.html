<!DOCTYPE html>
<html>

<head>
    <title>new post uwu</title>
    <link rel="stylesheet" href="style.css">
</head>

<svg style="display: none">
    <defs>
        <symbol id="lock-icon" viewBox="0 0 330 330">
            <path xmlns="http://www.w3.org/2000/svg" id="XMLID_505_"
                d="M65,330h200c8.284,0,15-6.716,15-15V145c0-8.284-6.716-15-15-15h-15V85c0-46.869-38.131-85-85-85   S80,38.131,80,85v45H65c-8.284,0-15,6.716-15,15v170C50,323.284,56.716,330,65,330z M207.481,219.356l-42.5,42.5   c-2.929,2.929-6.768,4.394-10.606,4.394s-7.678-1.465-10.606-4.394l-21.25-21.25c-5.858-5.858-5.858-15.354,0-21.213   c5.857-5.858,15.355-5.858,21.213,0l10.644,10.643l31.894-31.893c5.857-5.858,15.355-5.858,21.213,0   C213.34,204.002,213.34,213.498,207.481,219.356z M110,85c0-30.327,24.673-55,55-55s55,24.673,55,55v45H110V85z" />
        </symbol>
        <symbol id="unlock-icon" viewBox="0 0 330 330">
            <path xmlns="http://www.w3.org/2000/svg" id="XMLID_517_"
                d="M15,160c8.284,0,15-6.716,15-15V85c0-30.327,24.673-55,55-55c30.327,0,55,24.673,55,55v45h-25   c-8.284,0-15,6.716-15,15v170c0,8.284,6.716,15,15,15h200c8.284,0,15-6.716,15-15V145c0-8.284-6.716-15-15-15H170V85   c0-46.869-38.131-85-85-85S0,38.131,0,85v60C0,153.284,6.716,160,15,160z" />
        </symbol>
        <symbol id="share-icon" viewBox="0 0 458.624 458.624">
            <path xmlns="http://www.w3.org/2000/svg"
                d="M339.588,314.529c-14.215,0-27.456,4.133-38.621,11.239l-112.682-78.67c1.809-6.315,2.798-12.976,2.798-19.871    c0-6.896-0.989-13.557-2.798-19.871l109.64-76.547c11.764,8.356,26.133,13.286,41.662,13.286c39.79,0,72.047-32.257,72.047-72.047    C411.634,32.258,379.378,0,339.588,0c-39.79,0-72.047,32.257-72.047,72.047c0,5.255,0.578,10.373,1.646,15.308l-112.424,78.491    c-10.974-6.759-23.892-10.666-37.727-10.666c-39.79,0-72.047,32.257-72.047,72.047s32.256,72.047,72.047,72.047    c13.834,0,26.753-3.907,37.727-10.666l113.292,79.097c-1.629,6.017-2.514,12.34-2.514,18.872c0,39.79,32.257,72.047,72.047,72.047    c39.79,0,72.047-32.257,72.047-72.047C411.635,346.787,379.378,314.529,339.588,314.529z" />
        </symbol>
        <symbol id="delete-icon" viewBox="0 0 24 24">
            <path xmlns="http://www.w3.org/2000/svg"
                d="M5.755,20.283,4,8H20L18.245,20.283A2,2,0,0,1,16.265,22H7.735A2,2,0,0,1,5.755,20.283ZM21,4H16V3a1,1,0,0,0-1-1H9A1,1,0,0,0,8,3V4H3A1,1,0,0,0,3,6H21a1,1,0,0,0,0-2Z" />
        </symbol>
        <symbol id="edit-icon" viewBox="0 0 24 24">
            <g xmlns="http://www.w3.org/2000/svg" id="style=fill">
                <g id="edit">
                    <path id="Subtract" fill-rule="evenodd" clip-rule="evenodd"
                        d="M18.9405 3.12087L21.0618 5.24219C22.2334 6.41376 22.2334 8.31326 21.0618 9.48483L19.2586 11.288L12.8947 4.92403L14.6978 3.12087C15.8694 1.94929 17.7689 1.94929 18.9405 3.12087ZM11.834 5.98469L3.70656 14.1121C3.22329 14.5954 2.91952 15.2292 2.84552 15.9086L2.45151 19.5264C2.31313 20.7969 3.38571 21.8695 4.65629 21.7311L8.27401 21.3371C8.95345 21.2631 9.58725 20.9594 10.0705 20.4761L18.1979 12.3486L11.834 5.98469Z"
                        fill="#000000" />
                </g>
            </g>
        </symbol>
    </defs>
</svg>

<body>
    <canvas id="magneticCanvas"></canvas>
    <div class="container">
        <h1>add a new post uwu~</h1>

        <form id="new-post-form">
            <label for="post-type">Select Post Type:</label><br>
            <select id="post-type" name="post-type" class="textbox" required>
                <option value="image">Image</option>
                <option value="article">Article</option>
                <option value="microblog">Microblog</option>
            </select><br><br>

            <div id="common-fields">
                <label for="title">Title:</label><br>
                <input type="text" id="title" name="title" class="textbox"><br><br>

                <label for="thumbnail">Thumbnail URL:</label><br>
                <input type="text" id="thumbnail" name="thumbnail" class="textbox"><br><br>
            </div>

            <div id="description-field">
                <label for="description">Description:</label><br>
                <textarea id="description" name="description" class="textbox" rows="5" cols="60"></textarea><br><br>
            </div>

            <div id="content-field">
                <label for="content">Content (Markdown):</label><br>
                <textarea id="content" name="content" class="textbox" rows="10" cols="60"></textarea><br><br>
            </div>

            <label for="password">Password:</label><br>
            <input type="password" id="password" name="password" class="textbox" required><br><br>

            <button type="submit">post me!~</button>
        </form>
    </div>

    <div id="preview-container"></div>

    <div id="feed-container">
    </div>
    <script type="module" src="posts.js"></script>

    <script>
        const form = document.getElementById('new-post-form');
        const postTypeSelector = document.getElementById('post-type');
        const commonFields = document.getElementById('common-fields');
        const descriptionField = document.getElementById('description-field');
        const contentField = document.getElementById('content-field');
        const passwordField = document.getElementById('password');

        function updateFormFields() {
            const selectedType = postTypeSelector.value;

            commonFields.style.display = selectedType === 'image' || selectedType === 'article' ? 'block' : 'none';
            descriptionField.style.display = selectedType === 'article' ? 'block' : 'none';
            contentField.style.display = selectedType === 'article' || selectedType === 'microblog' ? 'block' : 'none';

            document.getElementById('title').required = selectedType === 'image' || selectedType === 'article';
            document.getElementById('thumbnail').required = selectedType === 'image' || selectedType === 'article';
            document.getElementById('description').required = selectedType === 'article';
            document.getElementById('content').required = selectedType === 'article' || selectedType === 'microblog';
        }

        postTypeSelector.addEventListener('change', updateFormFields);
        document.addEventListener('DOMContentLoaded', updateFormFields);

        form.addEventListener('submit', async (event) => {
            event.preventDefault(); // Prevent default form submission

            const postData = {
                type: document.getElementById('post-type').value,
                title: document.getElementById('title').value,
                thumbnail: document.getElementById('thumbnail').value,
                description: document.getElementById('description').value,
                content: document.getElementById('content').value
            };

            try {
                const response = await fetch('/api/posts', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'password': passwordField.value
                    },
                    body: JSON.stringify(postData)
                });

                if (response.ok) {
                    alert('Post created successfully!');
                    form.reset(); // Clear the form
                    updateFormFields(); // Update fields after reset
                } else {
                    const data = await response.json();
                    alert(`Error creating post: ${data.error}`);
                }
            } catch (error) {
                console.error('Error:', error);
                alert('An error occurred while creating the post.');
            }
        });
    </script>
    <script src="background.js"></script>

    <div id="ssl-indicator">
        <span id="ssl-icon"></span>
        <span id="ssl-text"></span>
    </div>
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const sslIndicator = document.getElementById('ssl-indicator');
            const sslIcon = document.getElementById('ssl-icon');
            const sslText = document.getElementById('ssl-text');

            if (window.location.protocol === 'https:') {
                sslText.textContent = 'Secure';
                sslIndicator.classList.add('ssl-secure');
                sslIcon.innerHTML = '<svg><use href="#lock-icon"></use></svg>';
            } else {
                sslText.textContent = 'Insecure';
                sslIndicator.classList.add('ssl-insecure');
                sslIcon.innerHTML = '<svg><use href="#unlock-icon"></use></svg>';
            }
        });
    </script>
</body>

</html>